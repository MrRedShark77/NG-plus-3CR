const allAchievements = {
  r11 : "You gotta start somewhere",
  r12 : "100 antimatter is a lot",
  r13 : "Half life 3 confirmed",
  r14 : "L4D: Left 4 Dimensions",
  r15 : "5 Dimension Antimatter Punch",
  r16 : "We couldn't afford 9",
  r17 : "Not a luck related achievement",
  r18 : "90 degrees to infinity",
  r21 : "To infinity!",
  r22 : "Fake News",
  r23 : "The 9th Dimension is a lie",
  r24 : "Antimatter Apocalypse",
  r25 : "Boosting to the max",
  r26 : "You got past The Big Wall",
  r27 : "Double Galaxy",
  r28 : "There's no point in doing that",
  r31 : "I forgot to nerf that",
  r32 : "The Gods are pleased",
  r33 : "That's a lot of infinites",
  r34 : "You didn't need it anyway",
  r35 : "Don't you dare to sleep",
  r36 : "Claustrophobic",
  r37 : "That's fast!",
  r38 : "I don't believe in Gods",
  r41 : "Spreading Cancer",
  r42 : "Supersanic",
  r43 : "Zero Deaths",
  r44 : "Over in 30 seconds",
  r45 : "Faster than a potato",
  r46 : "Multidimensional",
  r47 : "Daredevil",
  r48 : "AntiChallenged",
  r51 : "Limit Break",
  r52 : "Age of Automation",
  r53 : "Definitely not worth it",
  r54 : "That's faster!",
  r55 : "Forever isn't that long",
  r56 : "Many Deaths",
  r57 : "Gift from the Gods",
  r58 : "Is this hell?",
  r61 : "Bulked up",
  r62 : "Oh hey, you're still here",
  r63 : "A new beginning.",
  r64 : "1 million is a lot",
  r65 : "Not-so-challenging",
  r66 : "Faster than a squared potato",
  r67 : "Infinitely Challenging",
  r68 : "You did this again just for the achievement right?",
  r71 : "ERROR 909: Dimension not found",
  r72 : "Can't hold all these infinities",
  r73 : "This achievement doesn't exist",
  r74 : "End me",
  r75 : "NEW DIMENSIONS???",
  r76 : "One for each dimension",
  r77 : "How the antitables have turned",
  r78 : "Blink of an eye",
  r81 : "Hevipelle did nothing wrong",
  r82 : "Anti-antichallenged",
  r83 : "YOU CAN GET 50 GALAXIES!??",
  r84 : "I got a few to spare",
  r85 : "All your IP are belong to us",
  r86 : "Do you even bend time bro?",
  r87 : "2 Million Infinities",
  r88 : "Yet another infinity reference",
  r91 : "Ludicrous Speed",
  r92 : "I brake for nobody",
  r93 : "MAXIMUM OVERDRIVE",
  r94 : "Minute of infinity",
  r95 : "Is this safe?",
  r96 : "Time is relative",
  r97 : "Yes. This is hell.",
  r98 : "0 degrees from infinity",
  r101 : "Costco sells dimboosts now",
  r102 : "This mile took an Eternity",
  r103 : "This achievement doesn't exist II",
  r104 : "That wasn't an eternity",
  r105 : "Infinite time",
  r106 : "The swarm",
  r107 : "Do you really need a guide for this?",
  r108 : "We could afford 9",
  r111 : "Yo dawg, I heard you liked infinities...",
  r112 : "Never again",
  r113 : "Long lasting relationship",
  r114 : "You're a mistake",
  r115 : "I wish I had gotten 7 eternities",
  r116 : "Do I really need to infinity",
  r117 : "8 nobody got time for that",
  r118 : "IT'S OVER 9000",
  r121 : "Can you get infinite IP?",
  r122 : "You're already dead.",
  r123 : "5 more eternities until the update",
  r124 : "Eternities are the new infinity",
  r125 : "Like feasting on a behind",
  r126 : "Popular music",
  r127 : "But I wanted another prestige layer...",
  r128 : "What do I have to do to get rid of you",
  r131 : "No ethical consumption",
  r132 : "Unique snowflakes",
  r133 : "I never liked this infinity stuff anyway",
  r134 : "When will it be enough?",
  r135 : "Faster than a potato^286078",
  r136 : "I told you already, time is relative",
  r137 : "Now you're thinking with dilation!",
  r138 : "This is what I have to do to get rid of you.",

  s11 : "The first one's always free",
  s12 : "Just in case",
  s13 : "It pays to have respect",
  s14 : "So do I",
  s15 : "Do a barrel roll!",
  s16 : "Do you enjoy pain?",
  s17 : "30 Lives",
  s18 : "Do you feel lucky? Well do ya punk?",
  s21 : "Go study in real life instead",
  s22 : "Cancer = Spread",
  s23 : "Stop right there criminal scum!",
  s24 : "Real news",
  s25 : "Shhh... It's a secret",
  s26 : "You're a failure",
  s27 : "It's not called matter dimensions is it?",
  s28 : "Nice.",
  s31 : "You should download some more RAM",
  s32 : "Less than or equal to 0.001",
  s33 : "A sound financial decision",
  s34 : "You do know how these work, right?",
  s35 : "Should we tell them about buy max...",
  s36 : "While you were away... Nothing happened.",
  s37 : "You followed the instructions",
  s38 : "Professional bodybuilder",

  r141 : "Antimatter is made in Meta",
  r142 : "No Nine? Not nice...",
  r143 : "It got a Reality reference yet?",
  r144 : "'cow riding a skateboard'",
  r145 : "Super Booster!",
  r146 : "Anti-Immortal",
  r147 : "You have already dilated...",
  r148 : "Faster than a rainbow potato",

  r151 : "Protoversal Form",
  r152 : `Day 1209 of not using Dimensions:`,
  r153 : "este logro no existe 3",
  r154 : "Hadronization",
  r155 : `It is never stopped`,
  r156 : `Quantum Fission`,
  r157 : `Stellar Time`,
  r158 : `There's no way what I get rid of you.`,

  r161 : `I ran out of energy`,
  r162 : `Theorem of Everything`,
  r163 : `One lego can beat anything`,
  r164 : `Spicy Challenge`,
  r165 : `Nevermind, it has stopped...`,
  r166 : `I finally broke with this cap!`,
  r167 : `Exploration of Endless Time`,
  r168 : `Teach me how I get rid of you.`,

  r171 : `INSERT MODIFIER OR SELECT PAYMENT TYPE`,



  r175 : `I become death, the destroyer of quantum.`,

  r177 : `Society if dilation doesn’t exist`,


  s41 : "That dimension doesn’t exist",
  // s42,
  // s43,
  s44 : "Did you understand some numbers?",
  // s45,
  s46 : "Nightmare Mode",
  // s47,
  // s48,
};
const secretAchievementTooltips = {
    s11 : "Click on this achievement.",
    s12 : "Save 100 times without refreshing.",
    s13 : "Pay respects.",
    s14 : "Say something naughty.",
    s15 : "Do a barrel roll.",
    s16 : "Use standard, cancer, or bracket notation for 10 minutes with more than 1 eternity without refreshing.",
    s17 : "Input the konami code.",
    s18 : "You have a 1/100,000 chance of getting this achievement every second.",
    s21 : "Purchase the secret time study.",
    s22 : "Buy one million Galaxies in total while using cancer notation.",
    s23 : "Open the console.",
    s24 : "Click on the news ticker that tells you to click on it.",
    s25 : "Discover a secret theme.",
    s26 : "Fail eternity challenges 10 times without refreshing. What are you doing with your life...",
    s27 : "Get Infinite matter.",
    s28 : "Don't act like you don't know what you did.",
    s31 : "Set your update rate to 200ms.",
    s32 : "Get a fastest infinity or eternity time of less than or equal to 0.001 seconds.",
    s33 : "Click on the donate link.",
    s34 : "Respec with an empty study tree.",
    s35 : "Buy single tickspeed 1,000,000 times.",
    s36 : "Have nothing happen while you were away.",
    s37 : "Follow instructions.",
    s38 : "Get all your dimension bulk buyers to 1e100.",

    s41 : "Try to purchase the 9th dimension.",
    // s42
    // s43
    s44 : "Play the game using blind notation within 1 hour.",
    // s45
    s46 : "Run the game at 3:00 AM.",
    // s47
    // s48
  };
const allAchievementNums = Object.invert(allAchievements)
// to retrieve by value: Object.keys(allAchievements).find(key => allAchievements[key] === "L4D: Left 4 Dimensions");

var blindTime = 0

function clearOldAchieves(){
    var toRemove = [];
    var achieveKey;
    var values = Object.keys(allAchievements).map(function(e) { return allAchievements[e] });
    for (var i = 0; i < player.achievements.length; i++) {
      if (values.indexOf(player.achievements[i]) !== -1 ) {  // does index[i] exist in allAchievements as a value?
        toRemove.push(i); // mark it for removal
        achieveKey = Object.keys(allAchievements).find(function(key){ return allAchievements[key] === player.achievements[i];});
        if (!player.achievements.includes(achieveKey)) { // check if new key already exists as well
            player.achievements.push(achieveKey); // if not... add it
        }
      } else if (allAchievements[player.achievements[i]] === undefined){
        toRemove.push(i);
      }
    }


    toRemove.reverse();
    for (var i = 0; i < toRemove.length; i++) {
      player.achievements.splice(toRemove[i], 1);
    }
}

function giveAchievement(name,id=false) {

    if (player.achievements.includes(name) && !id){ clearOldAchieves(); }

    if (player.achievements.includes(id?name:allAchievementNums[name])) return false
    let k = id?allAchievements[name]:name

    $.notify(k, "success");
    player.achievements.push(id?name:allAchievementNums[name]);
    document.getElementById(k).className = "achievementunlocked"
    kong.submitStats('Achievements', player.achievements.length);
    if (k == "All your IP are belong to us" || k == "MAXIMUM OVERDRIVE") {
        player.infMult = player.infMult.times(4);
        player.autoIP = player.autoIP.times(4);
        if (player.autoCrunchMode == "amount" && player.autobuyers[11].priority != undefined) player.autobuyers[11].priority = player.autobuyers[11].priority.times(4);
    }
    updateAchievements();
}

function updateAchievementAria(domObj, isSecret=false) {
  var isLocked = domObj.classList.contains("achievementlocked") || domObj.classList.contains("achievementhidden");
  var label_text = (!isLocked) ? "(Completed) " : "";
  // Retrieve achievement row, trimming off the "r" or "s"
  label_text += allAchievementNums[domObj.id].substring(1) + ", ";
  label_text += domObj.id;
  // We only update labels with differing tooltips, which means that secret achievements should only be updated if they're unlocked.
  if(!isSecret || isSecret && !isLocked) {
    // Add a slight pause for screen readers, if necessary
    var punctuation_expr = /[.,:!?]$/;
    if (!punctuation_expr.test(label_text)) {
      label_text += ".";
    }
    label_text += " " + domObj.getAttribute("ach-tooltip");
  }
  domObj.setAttribute("aria-label", label_text);
}

function updateAchievements() {
  var amount = 0
  for (var i=1; i<document.getElementById("achievementtable").children[0].children.length+1; i++) {
      var n = 0
      var achNum = i * 10
      for (var l=0; l<8; l++) {
          achNum += 1;
          var name = allAchievements["r"+achNum]
            var domObj = el(name);
            if (!domObj) continue
          let class_name = "achievement"
          if (player.achievements.includes("r"+achNum)) {
              n++
              class_name += " achievementunlocked";
          } else {
            class_name += " achievementlocked";
          }
          if (!player.quantum.unlocked && i >= 15) class_name += " quantumized";
          domObj.className = class_name
          updateAchievementAria(domObj);
      }
      let ari = document.getElementById("achRow"+i)
      if (n == 8) {
          amount++
          ari.className = "completedrow"
          ari.style.display = player.options.hideCompletedAchs?"none":""
      } else {
          ari.className = ""
      }
  }
  for (var i=1; i<document.getElementById("secretachievementtable").children[0].children.length+1; i++) {
      var n = 0
      var achNum = i * 10
      for (var l=0; l<8; l++) {
          achNum += 1;
          var name = allAchievements["s"+achNum]
          var domObj = el(name)
          if (!domObj) continue;
          if (player.achievements.includes("s"+achNum)) {
              n++
              domObj.setAttribute('ach-tooltip', secretAchievementTooltips["s"+achNum]);
              domObj.className = "achievementunlocked";
              updateAchievementAria(domObj, true);
          } else {
              domObj.className = "achievementhidden";
              domObj.setAttribute('ach-tooltip', name) // (name[name.length-1] !== "?" && name[name.length-1] !== "!" && name[name.length-1] !== ".") ? name+"." : name
              updateAchievementAria(domObj, true);
          }
      }
      if (n == 8) {
          document.getElementById("secretAchRow"+i).className = "completedrow"
      } else {
          document.getElementById("secretAchRow"+i).className = ""
      }
  }

  player.achPow = Decimal.pow(1.5, amount)

  document.getElementById("achmultlabel").textContent = "Current achievement multiplier on each Dimension: " + player.achPow.toFixed(1) + "x"

}

function getSecretAchAmount() {
    var n = 0
    for (var i=1; i<document.getElementById("secretachievementtable").children[0].children.length+1; i++) {
        var achNum = i * 10
        for (var l=0; l<8; l++) {
            achNum += 1;
            if (player.achievements.includes("s"+achNum)) {
                n++
            }
        }
    }
    return n
}

/*
function checkADblocker() {
  let test = new Request(
    "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",
    // "https://static.ads-twitter.com/uwt.js",
    { method: "HEAD", mode: "no-cors" }
  );
 
  // (B) FIRE THE REQEST
  fetch(test)
  .then(res => alert("ADS ALLOWED"))
  .catch(err => alert("ADBLOCK DETECTED"));
}
*/

function toggleCompletedAchs() {
	// 0 == visible, 1 == not visible
	player.options.hideCompletedAchs = !player.options.hideCompletedAchs;
	updateAchievements();
	document.getElementById("hideCompletedAchs").textContent = (player.options.hideCompletedAchs ? "Show" : "Hide") + " completed achievement rows";
} 

function updateAchievementsTooltip() {
  el(allAchievements.r144).setAttribute('ach-tooltip',`Get over ${shortenMoney(Number.MAX_VALUE)} of tick reduction.`)
  el(allAchievements.r148).setAttribute('ach-tooltip',`Get more than ${shortenCosts(Decimal.pow(10,486539264))} ticks per second.`)

  el(allAchievements.r152).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e100000000'))} antimatter without Infinity, Time, nor Meta Dimensions in the quantum run.`)
  el(allAchievements.r153).setAttribute('ach-tooltip',`Reach ${shorten(E('9.99e999'))} meta-antimatter. Reward: Current achievement multiplier affects Meta-Dimensions.`)
  el(allAchievements.r155).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e100000'))} replicanti. Reward: Replicanti multiplier's formula is better.`)
  el(allAchievements.r157).setAttribute('ach-tooltip',`Reach ${shortenCosts(getStellarAgeRequirement())} antimatter.`)
  el(allAchievements.r158).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e200000'))} IP without having TS Tiers 1–2, Meta Dimensions, Protons, and Electrons while dilated in the quantum run.`)

  el(allAchievements.r162).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e60'))} Time Theorems. Reward: Weaken the softcap of 12th dilation upgrade.`)
  el(allAchievements.r165).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e200000'))} replicanti under one second in the quantum run.`)
  el(allAchievements.r166).setAttribute('ach-tooltip',`Purchase at least ${getFullExpansion(1e10)} first infinity dimensions.`)
  el(allAchievements.r167).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e100'))} Tachyon Particles. Reward: Further reduce free galaxy threshold.`)
  el(allAchievements.r168).setAttribute('ach-tooltip',`Big Crunch for ${shortenCosts(E('1e50'))} IP without having TS Tiers 1-2 in QC6 with EC15 modified. Reward: Time Theorems no longer get reset by Quantum.`)

  el(allAchievements.r177).setAttribute('ach-tooltip',`Reach ${shortenCosts(E('1e2000000'))} replicanti without having Tachyon particles. Reward: Start with the same amount of Tachyon particles as the square root of your best TP on quantum.`)
}

// CHECKING

function getStellarAgeRequirement() {
	let sec = Math.floor(new Date().getTime() / 1000 * 3) / 3
	sec += 1970 * 365.24 * 24 * 3600
	return Decimal.pow(10, 3 * sec)
}

function checkAchievements() {
  if (player.infinityDimension1.baseAmount/10>=2e6) giveAchievement('r143',true)
  if (tmp.tsReduce.min(1).pow(-1).gte(Number.MAX_VALUE)) giveAchievement('r144',true)
  if (player.totalTickGained >= 1e6) giveAchievement('r146',true)
  if (player.tickspeed.e <= -486539264) giveAchievement('r148',true)

  if (player.money.gte('1e100000000') && player.infinityDimension1.amount <= 0 && player.timeDimension1.amount <= 0 && player.meta[1].amount <= 0 && !player.meta.firstDBought) giveAchievement('r152',true)
  if (player.meta.antimatter.gte('9.99e999')) giveAchievement('r153',true)
  if (player.replicanti.amount.gte('1e100000')) giveAchievement('r155',true)
  if (player.quantum.color.r.gte(1) && player.quantum.color.g.gte(1) && player.quantum.color.b.gte(1)) giveAchievement('r154',true)
  if (player.money.gte(getStellarAgeRequirement())) giveAchievement('r157',true)
  if (player.timestudy.studies.length == 0
    && player.ts_tier[0].filter(x => !TS_DIL[2].includes(x)).length == 0
    && player.meta[1].amount <= 0 && !player.meta.firstDBought
  && player.dilation.active && player.infinityPoints.e >= 200000 && player.quantum.protons == 0 && player.quantum.electrons == 0) giveAchievement('r158',true)

  if (player.money.gte(Decimal.pow(10,inQC(5) ? 1e6 : 1e12))) giveAchievement('r161',true)
  if (Decimal.gte(player.timestudy.theorem,1e60)) giveAchievement('r162',true)
  if (player.infinityDimension1.baseAmount/10>=1e10) giveAchievement('r166',true)
  if (player.dilation.totalTachyonParticles.gte(1e100)) giveAchievement('r167',true)

  if (tmp.qc_total_modifiers>=32) giveAchievement('r175',true)
  if (player.replicanti.amount.l>=2e6 && player.dilation.totalTachyonParticles.lte(0)) giveAchievement('r177',true)

  // Secret

  if (player.options.notation == "Blind" && blindTime >= 36000) giveAchievement('s44',true)
}

function fastCheckAchievements() {
  if (player.quantum.time < 10 && player.replicanti.amount.gte('1e200000')) giveAchievement('r165',true)
}